server:
  port: 7890
  servlet:
    context-path: /hopechain

spring:
  application:
    name: bds-gateway-service  # æœåŠ¡åç§°
  config:
    import:
      - nacos:common.yaml
      - nacos:redis-config.yaml
  cloud:
    nacos:
      server-addr: 47.120.70.160:8848
      username: ${NACOS_USERNAME}
      password: ${NACOS_PASSWORD}
      config:
        namespace: ${NACOS_NAMESPACE}
        file-extension: yaml
        refresh-enabled: false
        shared-configs:
          - data-id: common.yaml
          - data-id: redis-config.yaml
      discovery:
        namespace: ${NACOS_NAMESPACE}
    gateway:
      discovery:
        locator:
          enabled: true # å¼€å¯åŠ¨æ€è·¯ç”±
      #      default-filters: # é…ç½®å…¨å±€é»˜è®¤è¿‡æ»¤å™¨
      #        - name: RequestRateLimiter
      #          args:
      #            redis-rate-limiter.replenishRate: 5
      #            redis-rate-limiter.burstCapacity: 10
      #            key-resolver: "#{@remoteAddrKeyResolver}"
      #        - name: CircuitBreaker
      #          args:
      #            name: defaultCircuitBreaker
      #            fallbackUri: forward:/fallback/default
      #            failureRateThreshold: 85            # ğŸš€ æ›´é«˜çš„å¤±è´¥å®¹å¿åº¦ï¼ˆé»˜è®¤50ï¼‰
      #            slowCallRateThreshold: 90           # ğŸš€ æ›´é«˜çš„æ…¢è°ƒç”¨å®¹å¿æ¯”ä¾‹ï¼ˆé»˜è®¤100ï¼‰
      #            slowCallDurationThreshold: 7s       # â±ï¸ æ…¢è°ƒç”¨çš„é˜ˆå€¼æ—¶é—´æ”¾å®½ï¼ˆé»˜è®¤2sï¼‰
      #            slidingWindowSize: 200              # ğŸ“Š æ›´å¤§çš„çª—å£æ”¶é›†æ›´å¤šæ•°æ®
      #            minimumNumberOfCalls: 3             # ğŸ“‰ æ›´æ—©å¼€å§‹ç»Ÿè®¡å¥åº·æƒ…å†µï¼ˆé»˜è®¤10ï¼‰
      #            waitDurationInOpenState: 3s         # â³ ç†”æ–­åæ›´å¿«å°è¯•æ¢å¤ï¼ˆé»˜è®¤60sï¼‰

      routes:
        - id: user
          uri: lb://bds-user-service
          predicates:
            - Path=/hopechain/user/**
          filters:
            - StripPrefix=1
        - id: project
          uri: lb://bds-project-service
          predicates:
            - Path=/hopechain/project/**
          filters:
            - StripPrefix=1
        - id: blockchain
          uri: lb://bds-blockchain-service
          predicates:
            - Path=/hopechain/blockchain/**
          filters:
            - StripPrefix=1
        - id: voucher
          uri: lb://bds-voucher-service
          predicates:
            - Path=/hopechain/voucher/**
          filters:
            - StripPrefix=1
        - id: donation
          uri: lb://bds-donation-service
          predicates:
            - Path=/hopechain/donation/**
          filters:
            - StripPrefix=1
        - id: fundflow
          uri: lb://bds-fundflow-service
          predicates:
            - Path=/hopechain/fundflow/**
          filters:
            - StripPrefix=1
  # ç¼“å­˜é…ç½®
  cache:
    type: caffeine
    caffeine:
      spec: maximumSize=1000,expireAfterWrite=60s
